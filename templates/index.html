<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bash Trainer Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar">
        <h2>üìã –ö–æ–º–∞–Ω–¥—ã ({{ commands|length }})</h2>
        <div class="progress-section">
            <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong><br>
            {{ stats.completed|length }} / {{ commands|length }} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ<br>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (stats.completed|length / commands|length * 100) if commands else 0 }}%;"></div>
            </div>
            <strong>{{ "%.1f"|format((stats.completed|length / commands|length * 100)) if commands else 0 }}%</strong>
        </div>
        
        <div class="section">
            <h3>üîÑ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞–Ω–∏–π:</h3>
            {% for cmd in command_history %}
            <div class="history-item {% if cmd.command == current_reminder.command %}current{% endif %} {% if cmd.command in stats.completed %}completed{% endif %}">
                <span class="history-number">{{ loop.index }}</span>
                <div class="command-preview">{{ cmd.command }}</div>
            </div>
            {% endfor %}
        </div>

        <div class="section">
            <h3>üìä –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</h3>
            {% set categories = [] %}
            {% for cmd in commands %}
                {% if cmd.category not in categories %}
                    {% set _ = categories.append(cmd.category) %}
                {% endif %}
            {% endfor %}
            
            {% for category in categories %}
            {% set cat_commands = commands|selectattr('category', 'equalto', category)|list %}
            {% set completed_count = cat_commands|selectattr('command', 'in', stats.completed)|list|length %}
            {% if cat_commands %}
            <div class="category-section">
                <strong>{{ category }}</strong>
                <small>({{ completed_count }}/{{ cat_commands|length }})</small>
                {% for cmd in cat_commands %}
                <div class="history-item {% if cmd.command == current_reminder.command %}current{% endif %} {% if cmd.command in stats.completed %}completed{% endif %} small-item">
                    {{ cmd.command }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <div class="header">
            <h1>üöÄ Bash Trainer Pro</h1>
            <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∫–æ–º–∞–Ω–¥ Linux ‚Ä¢ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ {{ settings.reminder_interval // 60 }} –º–∏–Ω—É—Ç</p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div class="settings-button-container">
            <button class="btn btn-settings" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <!-- –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞</h2>
                    <button class="close-btn" onclick="toggleSettings()">√ó</button>
                </div>
                
                <div class="settings-form">
                    <div class="setting-group">
                        <label for="reminder_interval">üìÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</label>
                        <select id="reminder_interval" class="setting-select">
                            <option value="60" {% if settings.reminder_interval == 60 %}selected{% endif %}>1 –º–∏–Ω—É—Ç–∞</option>
                            <option value="300" {% if settings.reminder_interval == 300 %}selected{% endif %}>5 –º–∏–Ω—É—Ç</option>
                            <option value="600" {% if settings.reminder_interval == 600 %}selected{% endif %}>10 –º–∏–Ω—É—Ç</option>
                            <option value="900" {% if settings.reminder_interval == 900 %}selected{% endif %}>15 –º–∏–Ω—É—Ç</option>
                            <option value="1800" {% if settings.reminder_interval == 1800 %}selected{% endif %}>30 –º–∏–Ω—É—Ç</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="sound_enabled" {% if settings.sound_enabled %}checked{% endif %}>
                            <span class="checkmark"></span>
                            üîä –ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        </label>
                    </div>
                    
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto_advance" {% if settings.auto_advance %}checked{% endif %}>
                            <span class="checkmark"></span>
                            üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –∑–∞–¥–∞–Ω–∏–π
                        </label>
                    </div>
                    
                    <div class="setting-actions">
                        <button class="btn btn-primary" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                        <button class="btn btn-danger" onclick="resetProgress()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                        <button class="btn btn-secondary" onclick="toggleSettings()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </div>
        </div>

        {% if current_reminder %}
        <div class="card">
            <h2>
                üéØ –¢–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ 
                <span class="category-badge category-{{ current_reminder.category|lower|replace('(', '')|replace(')', '')|replace(' ', '-') }}">
                    {{ current_reminder.category }}
                </span>
                {% if current_reminder.command == "–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!" %}
                üéâ
                {% endif %}
            </h2>
            
            <div class="assignment-content {% if current_reminder.command == '–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!' %}congratulations{% else %}normal{% endif %}">
                
                <div class="command">{{ current_reminder.command }}</div>
                
                <p><strong>üìù –û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ current_reminder.description }}</p>
                <p><strong>üö© –§–ª–∞–≥–∏:</strong> <span class="flags">{{ current_reminder.flags }}</span></p>
                <p><strong>üîß –ü—Ä–∏–º–µ—Ä:</strong> <code class="example-code">{{ current_reminder.example }}</code></p>
                <p><strong>üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ current_reminder.category }} | 
                   <strong>‚ö° –°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> {{ current_reminder.difficulty }}</p>
                
                {% if current_reminder.command != "–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!" %}
                <h3>üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:</h3>
                <div class="output-box">{{ current_reminder.output_example }}</div>
                
                <h3>üîç –ê–Ω–∞–ª–∏–∑ –∏ —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:</h3>
                <div class="analysis-box">{{ current_reminder.analysis|safe }}</div>
                {% endif %}
                
                <div class="action-buttons">
                    {% if current_reminder.command != "–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!" %}
                    <button class="btn btn-complete" onclick="markCompleted('{{ current_reminder.command }}')">
                        ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
                    </button>
                    {% endif %}
                    <button class="btn btn-sound" onclick="testSound()">üîä –¢–µ—Å—Ç –∑–≤—É–∫–∞</button>
                    <button class="btn btn-skip" onclick="skipReminder()">
                        {% if current_reminder.command == "–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!" %}üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ{% else %}‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞{% endif %}
                    </button>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="card">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 style="color: #27ae60;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</h3>
                    <p class="stat-number" style="color: #27ae60;">{{ stats.completed|length }}</p>
                    <p>–∫–æ–º–∞–Ω–¥</p>
                </div>
                <div class="stat-card">
                    <h3 style="color: #3498db;">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</h3>
                    <p class="stat-number" style="color: #3498db;">{{ stats.attempts.values()|sum }}</p>
                    <p>–ø—Ä–∞–∫—Ç–∏–∫–∏</p>
                </div>
                <div class="stat-card">
                    <h3 style="color: #e74c3c;">–û—Å—Ç–∞–ª–æ—Å—å</h3>
                    <p class="stat-number" style="color: #e74c3c;">{{ commands|length - stats.completed|length if commands else 0 }}</p>
                    <p>–∑–∞–¥–∞–Ω–∏–π</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function markCompleted(command) {
            fetch('/mark_completed', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({command: command})
            }).then(response => {
                if (response.ok) {
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                }
            });
        }
        
        function testSound() {
            fetch('/play_sound');
        }
        
        function skipReminder() {
            fetch('/skip_reminder').then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
        
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }
        
        function saveSettings() {
            const settings = {
                reminder_interval: document.getElementById('reminder_interval').value,
                sound_enabled: document.getElementById('sound_enabled').checked,
                auto_advance: document.getElementById('auto_advance').checked
            };
            
            fetch('/update_settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settings)
            }).then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
        
        function resetProgress() {
            if (confirm('‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –í—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç –æ–±–Ω—É–ª–µ–Ω—ã.')) {
                fetch('/reset_progress', {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    }
                });
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target === modal) {
                toggleSettings();
            }
        }
        
        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        setTimeout(() => {
            location.reload();
        }, 30000);
    </script>
</body>
</html>